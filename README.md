# TryEvisionRelease

## Abstract

When releasing a project that includes Evision 0.1.34 on Windows by `MIX_ENV=prod mix release`, it crashes at runtime.

I managed to avoid this issue by editing the configuration file generated by mix release.init and changing from embedded mode to interactive mode.

## Steps to Reproduce the Problem

1. **Create a Project**: Create a new Elixir project. For example, use the command `mix new <project_name>`.
2. **Add Dependency**: Edit the `mix.exs` file and add version 0.1.34 of `evision` to the `deps` function. Example: `{:evision, "~> 0.1.34"}`.
3. **Get Dependencies**: Run the `mix deps.get` command in the root directory of the project to fetch the necessary dependencies.
4. **Create a Release**: Execute the `MIX_ENV=prod mix release` command to create a production release.
5. **Start the Application**: Launch the application from the built release using the `_build/prod/rel/<project_name>/bin/<project_name> start` command.

## Dump in embedded mode

Part of `dump/erl_crash.dump`.

```dump
=ERROR REPORT==== 12-Feb-2024::22:40:01.077000 ===
Error in process <0.1265.0> with exit value:
{undef,[{dll_loader_helper,add_dll_directory,
                           [<<"f:/_/_build/prod/rel/try_evision_release/lib/evision-0.1.34/priv/x64/vc17/bin">>],
                           []},
        {evision_nif,load_nif,0,
                     [{file,"lib/generated/evision_nif.ex"},{line,15}]},
        {init,'-run_on_load_handler/2-fun-0-',1,
              [{file,"init.erl"},{line,1499}]}]}
```

## Release setting to avoid crash

Part of `rel/env.bat.eex`.

```bat
rem Set the release to load code on demand (interactive) instead of preloading (embedded).
rem Evision 0.1.34 will crash vm in windows release if it is embedded.
set RELEASE_MODE=interactive
```
